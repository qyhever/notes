import comp from "/Users/await/pros/notes/docs/.vuepress/.temp/pages/posts/node/mysql-pool.html.vue"
const data = JSON.parse("{\"path\":\"/posts/node/mysql-pool.html\",\"title\":\"\",\"lang\":\"zh-CN\",\"frontmatter\":{},\"headers\":[{\"level\":2,\"title\":\"创建连接：\",\"slug\":\"创建连接\",\"link\":\"#创建连接\",\"children\":[{\"level\":3,\"title\":\"主要优化方案：\",\"slug\":\"主要优化方案\",\"link\":\"#主要优化方案\",\"children\":[]},{\"level\":3,\"title\":\"使用方式：\",\"slug\":\"使用方式\",\"link\":\"#使用方式\",\"children\":[]},{\"level\":3,\"title\":\"关键优势：\",\"slug\":\"关键优势\",\"link\":\"#关键优势\",\"children\":[]}]}],\"git\":{},\"filePathRelative\":\"posts/node/mysql-pool.md\",\"excerpt\":\"<p>mysql-pool</p>\\n<div class=\\\"language-javascript line-numbers-mode\\\" data-highlighter=\\\"prismjs\\\" data-ext=\\\"js\\\"><pre><code><span class=\\\"line\\\"><span class=\\\"token keyword\\\">const</span> mysql <span class=\\\"token operator\\\">=</span> <span class=\\\"token function\\\">require</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'mysql'</span><span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span class=\\\"token comment\\\">// Create connection pool (recommended approach)</span></span>\\n<span class=\\\"line\\\"><span class=\\\"token keyword\\\">const</span> pool <span class=\\\"token operator\\\">=</span> mysql<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">createPool</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">  <span class=\\\"token literal-property property\\\">connectionLimit</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">10</span><span class=\\\"token punctuation\\\">,</span> <span class=\\\"token comment\\\">// Limit the number of connections</span></span>\\n<span class=\\\"line\\\">  <span class=\\\"token literal-property property\\\">host</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">'localhost'</span><span class=\\\"token punctuation\\\">,</span></span>\\n<span class=\\\"line\\\">  <span class=\\\"token literal-property property\\\">user</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">'root'</span><span class=\\\"token punctuation\\\">,</span></span>\\n<span class=\\\"line\\\">  <span class=\\\"token literal-property property\\\">password</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">'In123456.'</span><span class=\\\"token punctuation\\\">,</span></span>\\n<span class=\\\"line\\\">  <span class=\\\"token literal-property property\\\">database</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token string\\\">'r3'</span><span class=\\\"token punctuation\\\">,</span></span>\\n<span class=\\\"line\\\">  <span class=\\\"token literal-property property\\\">acquireTimeout</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">60000</span><span class=\\\"token punctuation\\\">,</span></span>\\n<span class=\\\"line\\\">  <span class=\\\"token literal-property property\\\">timeout</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token number\\\">60000</span><span class=\\\"token punctuation\\\">,</span></span>\\n<span class=\\\"line\\\">  <span class=\\\"token literal-property property\\\">reconnect</span><span class=\\\"token operator\\\">:</span> <span class=\\\"token boolean\\\">true</span></span>\\n<span class=\\\"line\\\"><span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span class=\\\"token comment\\\">// Test the pool connection</span></span>\\n<span class=\\\"line\\\"><span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">testConnection</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Promise</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">resolve<span class=\\\"token punctuation\\\">,</span> reject</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=&gt;</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">    pool<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getConnection</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">err<span class=\\\"token punctuation\\\">,</span> connection</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=&gt;</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>err<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">        console<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Error getting connection from pool:'</span><span class=\\\"token punctuation\\\">,</span> err<span class=\\\"token punctuation\\\">.</span>stack<span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\">        <span class=\\\"token function\\\">reject</span><span class=\\\"token punctuation\\\">(</span>err<span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\">      <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">        console<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Connected to MySQL pool as id '</span> <span class=\\\"token operator\\\">+</span> connection<span class=\\\"token punctuation\\\">.</span>threadId<span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\">        connection<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">release</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token comment\\\">// Always release the connection back to pool</span></span>\\n<span class=\\\"line\\\">        <span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\">      <span class=\\\"token punctuation\\\">}</span></span>\\n<span class=\\\"line\\\">    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\">  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\"><span class=\\\"token punctuation\\\">}</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span class=\\\"token comment\\\">// Execute query using connection pool</span></span>\\n<span class=\\\"line\\\"><span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">exec</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">sql<span class=\\\"token punctuation\\\">,</span> data <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">[</span><span class=\\\"token punctuation\\\">]</span></span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Promise</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">resolve<span class=\\\"token punctuation\\\">,</span> reject</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=&gt;</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">    pool<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">query</span><span class=\\\"token punctuation\\\">(</span>sql<span class=\\\"token punctuation\\\">,</span> data<span class=\\\"token punctuation\\\">,</span> <span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">error<span class=\\\"token punctuation\\\">,</span> results</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=&gt;</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>error<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">        console<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'Exec error:'</span><span class=\\\"token punctuation\\\">,</span> error<span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\">        <span class=\\\"token keyword\\\">return</span> <span class=\\\"token function\\\">reject</span><span class=\\\"token punctuation\\\">(</span>error<span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\">      <span class=\\\"token punctuation\\\">}</span></span>\\n<span class=\\\"line\\\">      <span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span>results<span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\">    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\">  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\"><span class=\\\"token punctuation\\\">}</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span class=\\\"token comment\\\">// Get a connection from pool (for transactions)</span></span>\\n<span class=\\\"line\\\"><span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">getConnection</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Promise</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">resolve<span class=\\\"token punctuation\\\">,</span> reject</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=&gt;</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">    pool<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">getConnection</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">err<span class=\\\"token punctuation\\\">,</span> connection</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=&gt;</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">      <span class=\\\"token keyword\\\">if</span> <span class=\\\"token punctuation\\\">(</span>err<span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">        <span class=\\\"token function\\\">reject</span><span class=\\\"token punctuation\\\">(</span>err<span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\">      <span class=\\\"token punctuation\\\">}</span> <span class=\\\"token keyword\\\">else</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">        <span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span>connection<span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\">      <span class=\\\"token punctuation\\\">}</span></span>\\n<span class=\\\"line\\\">    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\">  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\"><span class=\\\"token punctuation\\\">}</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\"><span class=\\\"token comment\\\">// Close the pool (call this when shutting down the app)</span></span>\\n<span class=\\\"line\\\"><span class=\\\"token keyword\\\">function</span> <span class=\\\"token function\\\">closePool</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">  <span class=\\\"token keyword\\\">return</span> <span class=\\\"token keyword\\\">new</span> <span class=\\\"token class-name\\\">Promise</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token parameter\\\">resolve</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=&gt;</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">    pool<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">end</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span> <span class=\\\"token operator\\\">=&gt;</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">      console<span class=\\\"token punctuation\\\">.</span><span class=\\\"token function\\\">log</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token string\\\">'MySQL pool closed'</span><span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\">      <span class=\\\"token function\\\">resolve</span><span class=\\\"token punctuation\\\">(</span><span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\">    <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\">  <span class=\\\"token punctuation\\\">}</span><span class=\\\"token punctuation\\\">)</span></span>\\n<span class=\\\"line\\\"><span class=\\\"token punctuation\\\">}</span></span>\\n<span class=\\\"line\\\"></span>\\n<span class=\\\"line\\\">module<span class=\\\"token punctuation\\\">.</span>exports <span class=\\\"token operator\\\">=</span> <span class=\\\"token punctuation\\\">{</span></span>\\n<span class=\\\"line\\\">  pool<span class=\\\"token punctuation\\\">,</span></span>\\n<span class=\\\"line\\\">  testConnection<span class=\\\"token punctuation\\\">,</span></span>\\n<span class=\\\"line\\\">  exec<span class=\\\"token punctuation\\\">,</span></span>\\n<span class=\\\"line\\\">  getConnection<span class=\\\"token punctuation\\\">,</span></span>\\n<span class=\\\"line\\\">  closePool</span>\\n<span class=\\\"line\\\"><span class=\\\"token punctuation\\\">}</span></span>\\n<span class=\\\"line\\\"></span></code></pre>\\n<div class=\\\"line-numbers\\\" aria-hidden=\\\"true\\\" style=\\\"counter-reset:line-number 0\\\"><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div><div class=\\\"line-number\\\"></div></div></div>\"}")
export { comp, data }

if (import.meta.webpackHot) {
  import.meta.webpackHot.accept()
  if (__VUE_HMR_RUNTIME__.updatePageData) {
    __VUE_HMR_RUNTIME__.updatePageData(data)
  }
}

if (import.meta.hot) {
  import.meta.hot.accept(({ data }) => {
    __VUE_HMR_RUNTIME__.updatePageData(data)
  })
}
